<!DOCTYPE html>
<html>
<head>
	<title>IdentiHeart</title>
	<script type="text/javascript" src="dist/identiheart.min.js"></script>
	<link rel="icon" href="favicon.ico" />
	<style type="text/css">
		html, body {
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			display: flex;
			justify-content: center;
			align-items: center;
			overflow: hidden;
			background-color: #212121;
			font-size: 14px;
		}
		* {
			box-sizing: border-box;
		}
		canvas {
			position: relative;
			width: 15em;
			border-radius: 50%;
			transition: width 0.3s, height 0.3s;
			background-color: #fff;
		}
		.canvas-overlay {
			position: absolute;
			display: flex;
			justify-content: center;
			align-items: center;
			top: 50%;
			left: 50%;
			width: 15em;
			height: 15em;
			border-radius: 50%;
			background-color: rgba(0,0,0,.5);
			cursor: pointer;
			text-align: center;
			opacity: 0;
			transition: opacity 0.4s, width 0.2s, height 0.2s;

			-moz-transform: translateX(-50%) translateY(-50%);
			-webkit-transform: translateX(-50%) translateY(-50%);
			-o-transform: translateX(-50%) translateY(-50%);
			-ms-transform: translateX(-50%) translateY(-50%);
			transform: translateX(-50%) translateY(-50%);
		}
		.canvas-overlay:hover {
			opacity: 1;
			transition: opacity 0.4s, width 0.2s, height 0.2s;
		}
		.canvas-overlay>span {
			font-family: sans-serif;
			color: white;
			font-size: 1.2em;
			text-shadow: 0 0 5px black;
			cursor: pointer;
		}
		nav {
			position: absolute;
			display: flex;
			justify-content: space-between;
			align-items: center;
			width: 100%;
			padding: 1em;
			top: 0;
			left: 0;
		}
		input#username {
			position: relative;
			width: 300px;
			padding: 0.5em 1em;
			font-size: 14px;
			font-family: sans-serif;
			border: none;
			border-radius: 3px 3px 0 0;
			outline: none;
		}
		.size-container {
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: relative;
			margin: 0;
			padding: 0.5em 1em;
			background-color: rgba(0,0,0,0.15);
			border-radius: 3px;
		}
		.size-container>label,
		.size-container span {
			font-size: 1em;
			color: #fff;
			font-family: sans-serif;
		}
		.size-container>label {
			margin-right: 1em;
		}
		.size-container>span {
			margin-left: 1em;
		}
		a.test-link {
			display: block;
			position: absolute;
			bottom: 5px;
			right: 5px;
			font-family: sans-serif;
			text-decoration: none;
			color: white;
			padding: 0.5em 1em;
			font-size: 1em;
			background-color: rgba(0,0,0,0.15);
			cursor: pointer;
		}
		.username-container {
			position: relative;
		}
		.controls {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			align-content: center;
			position: absolute;
			top: 100%;
			left: 0;
			width: 100%;
			padding: 0em;
			background-color: rgba(0,0,0,0.15);
			border-radius: 0 0 3px 3px;
		}
		.controls>label {
			display: flex;
			justify-content: space-between;
			align-items: center;
			flex-wrap: nowrap;
			position: relative;
			width: 100%;
			font-size: 1em;
			padding: 0.5em;
			color: white;
			font-family: Geneva, Tahoma, Verdana, sans-serif;
		}
		.controls>label:not(:first-child) {
			border-top: 1px solid rgba(255,255,255,.1);
		}
		.sub-input {
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.sub-input>span {
			margin-left: 5px;
			line-height: 100%;
		}
		.display {
			width: 3em;
			text-align: center;
		}
	</style>
</head>
<body>
	<canvas height='500' id='identicon' width='500'></canvas>
	<div class="canvas-overlay" id="download">
		<span>Download image</span>
	</div>

	<nav>
		<div class="username-container">
			<input id='username' type='text' value='Schlipak' placeholder="Type your username or a string">
			<div class="controls">
				<label for="hasStroke">
					Stroke
					<input type="checkbox" id="hasStroke" checked="true">
				</label>
				<label for="strokeWeight">
					Stroke weight
					<div class="sub-input">
						<input type="range" id="strokeWeight" max="1000" min="0" step="10" value="500">
						<span id="strokeWeight-display" class="display">500</span>
					</div>
				</label>
				<label for="strokeColor">
					Stroke color
					<input type="color" id="strokeColor" value="#000000">
				</label>
				<label for="compositeOperation">
					Composite operation
					<select name="compositeOperation" id="compositeOperation">
						<option value="source-over">source-over</option>
						<option value="source-in">source-in</option>
						<option value="source-out">source-out</option>
						<option value="source-atop">source-atop</option>
						<option value="destination-over">destination-over</option>
						<option value="destination-in">destination-in</option>
						<option value="destination-out">destination-out</option>
						<option value="destination-atop">destination-atop</option>
						<option value="lighter">lighter</option>
						<option value="copy">copy</option>
						<option value="xor">xor</option>
						<option value="multiply" selected="selected">multiply</option>
						<option value="screen">screen</option>
						<option value="overlay">overlay</option>
						<option value="darken">darken</option>
						<option value="lighten">lighten</option>
						<option value="color-dodge">color-dodge</option>
						<option value="color-burn">color-burn</option>
						<option value="hard-light">hard-light</option>
						<option value="soft-light">soft-light</option>
						<option value="difference">difference</option>
						<option value="exclusion">exclusion</option>
						<option value="hue">hue</option>
						<option value="saturation">saturation</option>
						<option value="color">color</option>
						<option value="luminosity">luminosity</option>
					</select>
				</label>
			</div>
		</div>
		<div class='size-container'>
			<label for='size'>Scale</label>
			<input id='size' max='30' min='2' step='1' type='range' value='15'>
			<span id='size-display' class='display'>15em</span>
		</div>
	</nav>

	<a class="test-link" href="./test">Tests</a>

	<script type="text/javascript">
		var c = document.getElementById("identicon");
		var ctx = c.getContext("2d");

		var d = document.getElementById('download');
		var uInput = document.getElementById("username");
		var hasStrokeInput = document.getElementById('hasStroke');
		var strokeWeightInput = document.getElementById('strokeWeight');
		var strokeColorInput = document.getElementById('strokeColor');
		var compositeOperationInput = document.getElementById('compositeOperation');

		var username, hasStroke, strokeWeight, strokeColor, compositeOperation;

		var h = new IdentiHeart(c, ctx);
		refreshValues();
		redraw();

		function refreshValues() {
			username = uInput.value;
			hasStroke = hasStrokeInput.checked;
			strokeWeight = Number(strokeWeightInput.value);
			strokeColor = strokeColorInput.value;
			compositeOperation = compositeOperationInput.options[compositeOperationInput.selectedIndex].value;
		}

		function redraw() {
			h.setUsername(username);
			h.setHasStroke(hasStroke);
			h.setStrokeWeight(strokeWeight);
			h.setStrokeColor(strokeColor);
			h.setCompositeOperation(compositeOperation);

			h.init();
			h.draw();	
		}

		var isMouseDown = false;

		uInput.oninput = function() {
			refreshValues();
			redraw();
		}

		hasStrokeInput.onchange = function() {
			refreshValues();
			redraw();
		}

		function updateStrokeWeight(e) {
			var val = e.target.value;
			document.getElementById('strokeWeight-display').innerHTML = val;

			refreshValues();
			redraw();
		}

		strokeWeightInput.onmousedown = function() { isMouseDown = true };
		strokeWeightInput.onmouseup = function() { isMouseDown = false };
		strokeWeightInput.onmousemove = function(e) { if(!isMouseDown){return}; updateStrokeWeight(e); };
		strokeWeightInput.onchange = function(e) { updateStrokeWeight(e) };

		strokeColorInput.onchange = function(e) {
			refreshValues();
			redraw();
		}

		compositeOperationInput.onchange = function() {
			refreshValues();
			redraw();
		}

		var sizeInput = document.getElementById('size');

		function updateSizeInput(e) {
			var val = e.target.value;
			c.style.width = val + 'em';

			d.style.width = val + 'em';
			d.style.height = val + 'em';

			document.getElementById('size-display').innerHTML = val + 'em';

			h.init();
			h.draw();
		}

		sizeInput.onmousedown = function() { isMouseDown = true };
		sizeInput.onmouseup = function() { isMouseDown = false };
		sizeInput.onmousemove = function(e) { if(!isMouseDown){return}; updateSizeInput(e); };
		sizeInput.onchange = function(e) { updateSizeInput(e) };

		d.onclick = function() {
			var d = c.toDataURL("image/png");
			var w = window.open('about:blank','_blank');
			w.document.write("<img src='"+d+"' alt='"+username+"' title='"+username+"'/>");
		}
	</script>
</body>
</html>
